<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Grupo SHELF — Abertura</title>
    <link rel="icon" href="img/logo.png" />
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html,
        body {
            height: 100%;
            width: 100%;
        }

        body {
            background: #000;
            font-family: 'Segoe UI', system-ui, sans-serif;
            overflow: hidden;
        }

        /* GATE */
        .gate {
            position: fixed;
            inset: 0;
            display: grid;
            place-items: center;
            background: #1e3d1a;
            color: #fff;
            z-index: 4;
            text-align: center;
            padding: 24px;
        }

        .gate .wrap {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 18px;
        }

        .gate img {
            width: 86px;
            height: 86px;
            border-radius: 16px;
        }

        .gate h1 {
            margin: 0;
            font-size: 28px;
            letter-spacing: .5px;
        }

        .gate p {
            opacity: .9;
            max-width: 360px;
        }

        .btn {
            padding: 12px 18px;
            border-radius: 999px;
            border: none;
            cursor: pointer;
            font-weight: 700;
            font-size: 16px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, .25);
            transition: transform .15s ease, background .2s ease;
        }

        .btn-primary {
            background: #0b5;
            color: #fff;
        }

        .btn-primary:hover {
            transform: translateY(-1px);
            background: #0a4;
        }

        /* INTRO */
        .intro {
            position: fixed;
            inset: 0;
            display: grid;
            place-items: center;
            background: #000;
            z-index: 2;
        }

        video {
            height: 100vh;
            object-fit: cover;
            background: #000;
        }

        .overlay {
            position: absolute;
            inset: 0;
            background: linear-gradient(to top, rgba(0, 0, 0, .35), rgba(0, 0, 0, .15));
            pointer-events: none;
        }

        .brand {
            position: absolute;
            left: 20px;
            bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            pointer-events: none;
        }

        .brand img {
            width: 40px;
            height: 40px;
            border-radius: 10px;
        }

        .brand span {
            color: #cde8c9;
            font-weight: 600;
            letter-spacing: .5px;
        }

        /* Botão Pular (fixo e acima de tudo) */
        .skip {
            position: fixed;
            right: 20px;
            bottom: 20px;
            padding: 12px 18px;
            border-radius: 999px;
            background: #1e3d1a;
            color: #fff;
            border: none;
            cursor: pointer;
            font-size: 15px;
            font-weight: 600;
            box-shadow: 0 6px 20px rgba(0, 0, 0, .25);
            transition: transform .15s ease, opacity .2s ease, background .2s ease;
            z-index: 6;
        }

        .skip:hover {
            transform: translateY(-1px);
            background: #2a5524;
        }

        /* FALLBACK */
        .fallback {
            position: fixed;
            inset: 0;
            display: grid;
            place-items: center;
            background: #1e3d1a;
            color: #fff;
            text-align: center;
            padding: 24px;
            opacity: 0;
            transform: scale(.98);
            transition: opacity .25s ease, transform .25s ease;
            z-index: 3;
        }

        .fallback.show {
            opacity: 1;
            transform: scale(1);
        }

        .fallback .logo {
            display: flex;
            align-items: center;
            gap: 14px;
        }

        .fallback .logo img {
            width: 80px;
        }

        .fallback .logo .txt h1 {
            font-size: 36px;
            line-height: 1;
            margin: 0;
        }

        .fallback .logo .txt span {
            font-size: 20px;
            color: #cde8c9;
            letter-spacing: 6px;
        }

        .fallback .actions {
            margin-top: 16px;
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        @media (max-width: 768px) {
            video {
                width: 100vw;
                height: auto;
                object-fit: cover;
                background: #000;
            }

            .brand {
                left: 12px;
                bottom: 12px;
            }

            .skip {
                right: 12px;
                bottom: 12px;
                padding: 10px 14px;
                font-size: 14px;
            }

            .gate img {
                width: 72px;
                height: 72px;
            }
        }

        /* View Transitions */
        @keyframes vt-fade-out {
            to {
                opacity: 0;
                transform: scale(1.01);
                filter: blur(2px);
            }
        }

        @keyframes vt-fade-in {
            from {
                opacity: 0;
                transform: scale(0.995);
                filter: blur(2px);
            }
        }

        ::view-transition-old(root) {
            animation: vt-fade-out .45s ease both;
        }

        ::view-transition-new(root) {
            animation: vt-fade-in .45s ease both;
        }

        /* Fallback crossfade pro verde */
        .page-fade {
            position: fixed;
            inset: 0;
            background: #1e3d1a;
            opacity: 0;
            pointer-events: none;
            z-index: 9999;
            transition: opacity .45s ease;
        }

        .page-fade.show {
            opacity: 1;
        }
    </style>
</head>

<body>

    <!-- GATE -->
    <div class="gate" id="gate">
        <div class="wrap">
            <img src="img/logo.png" alt="SHELF" />
            <h1>SHELF Distribuidora</h1>
            <p>Toque em “Entrar” para iniciar.</p>
            <button class="btn btn-primary" id="enterBtn" type="button">Entrar</button>
        </div>
    </div>

    <!-- INTRO -->
    <div class="intro" id="intro">
        <video id="introVideo" playsinline preload="auto" poster="img/logo.png">
            <source src="video/video-abertura.mp4" type="video/mp4" />
            <!-- <source src="video/shelf-intro.mp4" type="video/mp4" /> -->
            Seu navegador não suporta vídeo HTML5.
        </video>

        <div class="overlay" aria-hidden="true"></div>
        <div class="brand" aria-hidden="true">
            <img src="img/logo.png" alt="" />
            <span>SHELF Distribuidora</span>
        </div>
    </div>

    <!-- Botão Pular (fixo e sempre por cima) -->
    <button class="skip" id="skipBtn" type="button">Pular</button>

    <!-- FALLBACK -->
    <div class="fallback" id="fallback" role="dialog" aria-live="polite" aria-label="Abertura">
        <div class="logo">
            <img src="img/logo.png" alt="Grupo SHELF" />
            <div class="txt">
                <h1>SHELF</h1>
                <span>Distribuidora</span>
            </div>
        </div>
        <p style="margin-top:10px;opacity:.85;">Não foi possível reproduzir o vídeo.</p>
        <div class="actions">
            <button class="btn btn-primary" id="fallbackSkip" type="button">Pular</button>
        </div>
    </div>

    <script>
        const REDIRECT_URL = "login.html";
        const INTRO_MAX_MS = 27000;
        const SHOW_FALLBACK_IF_NO_PLAY_MS = 800;

        const gate = document.getElementById("gate");
        const enterBtn = document.getElementById("enterBtn");
        const video = document.getElementById("introVideo");
        const skipBtn = document.getElementById("skipBtn");
        const fallback = document.getElementById("fallback");
        const fallbackSkip = document.getElementById("fallbackSkip");

        function goNext() {
            if (window.__wentNext) return;
            window.__wentNext = true;

            // 1) fade-out de áudio do vídeo (suave)
            try {
                const vid = document.getElementById("introVideo");
                if (vid && typeof vid.volume === "number") {
                    let v = vid.volume ?? 1;
                    const step = 0.08;
                    const every = 40;
                    const timer = setInterval(() => {
                        v = Math.max(0, v - step);
                        vid.volume = v;
                        if (v <= 0) clearInterval(timer);
                    }, every);
                }
            } catch (e) { /* ignora */ }

            const navigate = () => { window.location.href = REDIRECT_URL; };

            // 2) View Transitions
            if (document.startViewTransition) {
                document.startViewTransition(() => navigate());
                return;
            }

            // 3) Fallback: overlay verde e depois navega
            const overlay = document.createElement("div");
            overlay.className = "page-fade";
            document.body.appendChild(overlay);
            overlay.offsetHeight; /* força reflow */
            overlay.classList.add("show");
            setTimeout(navigate, 450);
        }

        // Entrar -> toca com áudio
        enterBtn.addEventListener("click", async () => {
            try {
                gate.style.display = "none";
                video.muted = false;
                video.currentTime = 0;
                await video.play();
                setTimeout(goNext, INTRO_MAX_MS);
            } catch (e) {
                console.error("Falha ao iniciar vídeo:", e);
                fallback.classList.add("show");
            }
        });

        // Pular
        skipBtn.addEventListener("click", goNext);
        if (fallbackSkip) fallbackSkip.addEventListener("click", goNext);

        // Fallback se erro
        video.addEventListener("error", () => fallback.classList.add("show"));

        // Fallback se não começar a tocar logo após o clique
        video.addEventListener("playing", () => { window.__isPlaying = true; });
        setTimeout(() => {
            if (!window.__isPlaying && gate.style.display === "none") {
                fallback.classList.add("show");
            }
        }, SHOW_FALLBACK_IF_NO_PLAY_MS);

        // Ao terminar, segue
        video.addEventListener("ended", goNext);
    </script>
</body>

</html>